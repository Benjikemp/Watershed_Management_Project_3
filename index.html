<!DOCTYPE html>
<html>

<head>
    <title>The Land Between Recharge Zones</title>
    <style>
        #header {
            background-color: #ffffff;
            /* Background color for the header */
            text-align: center;
            padding: 20px;
            /* Adjust the padding for spacing */
        }

        #logo {
            width: 150px;
            /* Adjust the logo width */
        }

        #title {
            font-size: 24px;
            margin-top: 10px;
            /* Adjust the margin for spacing */
        }

        #map {
            height: 400px;
            margin: 0 auto;
            /* Center the map horizontally */
        }

        body {
            text-align: center;
            /* Center align the title */
        }

        .legend {
            background-color: white;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            clear: both;
            font-size: 12px;
            line-height: 18px;
            color: #555;
        }

        .legend i {
            width: 18px;
            height: 18px;
            float: left;
            margin-right: 8px;
            opacity: 0.7;
        }
    </style>
    <link rel="stylesheet" href="leaflet/leaflet.css" />
</head>

<body>
    <div id="header">
        <img id="logo" src="Logo_TLB_2.png" alt="Working Watershed Project Logo">
        <h1 id="title">Working Watersheds Mapping</h1>
    </div>
    <div id="map"></div>
    <script src="leaflet/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-ajax@2.1.0/dist/leaflet.ajax.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chroma-js@2.1.0"></script>
    <script>
        var map = L.map('map').setView([0, 0], 10);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

        function getColor(d) {
            return chroma.scale(['lightblue', 'darkblue']).mode('lab')(d);
        }

        function onEachFeature(feature, layer) {
            if (feature.properties) {
                var popupContent = "<h3>Feature Attributes</h3>" +
                    "<strong>Velocity (m/s):</strong> " + feature.properties.MEAN_Darcy_velocity + "<br>";
                layer.bindPopup(popupContent);
            }
        }

        // Placeholder Darcy flow values
        var values = [0, 0.05, 0.1, 0.15, 0.2];

        // Create legend
        var legend = L.control({ position: 'bottomright' });

        legend.onAdd = function (map) {
            var div = L.DomUtil.create('div', 'info legend');
            div.innerHTML += '<h4>Flow Velocity (m/s)</h4>';
            for (var i = 0; i < values.length - 1; i++) {
                div.innerHTML +=
                    '<i style="background:' + getColor((values[i] + values[i + 1]) / 2) + '"></i> ' +
                    values[i] + (values[i + 1] ? '&ndash;' + values[i + 1] + '<br>' : '+');
            }
            return div;
        };

        legend.addTo(map);

        var baseMaps = {
            "Map": L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png')
        };

        // Load GeoJSON data for Darcy Flow layers
        var darcyFlowLayerOne = L.geoJSON.ajax("AverageSubsurf_FeaturesToJSO1.geojson", {
            style: function (feature) {
                return {
                    fillColor: getColor(feature.properties.MEAN_Darcy_velocity),
                    color: 'black',
                    weight: 1,
                    opacity: 1,
                    fillOpacity: 0.7,
                };
            },
            onEachFeature: onEachFeature,
        });

        var darcyFlowLayerTwo = L.geoJSON.ajax("AverageSubsurf_FeaturesToJSO2.geojson", {
            style: function (feature) {
                return {
                    fillColor: getColor(feature.properties.MEAN_Darcy_velocity),
                    color: 'black',
                    weight: 1,
                    opacity: 1,
                    fillOpacity: 0.7,
                };
            },
            onEachFeature: onEachFeature,
        });

        // Combine Darcy Flow layers into a single layer group
        var darcyFlowLayersGroup = L.layerGroup([darcyFlowLayerOne, darcyFlowLayerTwo]);

        var headWaterPourPoints = L.geoJSON.ajax("ToJSO.geojson", {
            pointToLayer: function (feature, latlng) {
                return L.circleMarker(latlng, {
                    radius: 5,
                    fillColor: 'black',
                    color: 'black',
                    weight: 1,
                    opacity: 1,
                    fillOpacity: 0.7,
                });
            },
            onEachFeature: onEachFeature,
        });

        var dischargeWatersheds = L.geoJSON.ajax("Discharge_Zone_FeaturesToJSO.geojson", {
            style: {
                fillColor: 'yellow',
                color: 'yellow',
                weight: 1,
                opacity: 1,
                fillOpacity: 0.7,
            },
            onEachFeature: onEachFeature,
        });

        var dischargePourPoints = L.geoJSON.ajax("Watershed4Pour_FeaturesToJSO.geojson", {
            pointToLayer: function (feature, latlng) {
                return L.circleMarker(latlng, {
                    radius: 5,
                    fillColor: 'red',
                    color: 'red',
                    weight: 1,
                    opacity: 1,
                    fillOpacity: 0.7,
                });
            },
            onEachFeature: onEachFeature,
        });

        L.control.layers(baseMaps, {
            "Head-Water Watersheds": L.geoJSON.ajax("Recharge_Zones_ToJSO.geojson", {
                style: {
                    color: 'red',
                    weight: 2,
                },
                onEachFeature: onEachFeature,
            }),
            "Average Subsurface Flow (m/s)": darcyFlowLayersGroup,
            "Head-Water Pour Points": headWaterPourPoints,
            "Discharge Watersheds": dischargeWatersheds,
            "Discharge Pour Points": dischargePourPoints,
            // Additional Info layer
            "Additional Info": addAdditionalInfo()
        }, { collapsed: false, groupName: "Layers" }).addTo(map);

        // Function to add the additional info text
        function addAdditionalInfo() {
            var div = document.createElement('div');
            div.innerHTML = "<h2>Additional Information</h2>" +
                "<p>Layers Produced:</p>" +
                "<ul>" +
                "<li>Headwater/recharge watersheds layer</li>" +
                "<li>Headwater/recharge watersheds pour point layer</li>" +
                "<li>Discharge watersheds Layer</li>" +
                "<li>Discharge watersheds pour point Layer</li>" +
                "<li>Wetland classification layer</li>" +
                "<li>Darcy flow layer</li>" +
                "</ul>" +
                "<p>Data sources Used:</p>" +
                "<ul>" +
                "<li>Headwater/recharge pour point layer" +
                "<ul>" +
                "<li>MNR Hydro Network</li>" +
                "</ul>" +
                "</li>" +
                "<li>Headwater/recharge watershed layer" +
                "<ul>" +
                "<li>Headwater/recharge pour point layer.</li>" +
                "<li>MNR Provincial Digital Elevation Model</li>" +
                "</ul>" +
                "</li>" +
                // ... (The rest of your provided text)
                "</ul>" +
                "<p>Methods:</p>" +
                "<p>Headwater/recharge pour point layer.</p>" +
                "<p>This layer was produced using the Ministry of natural resources (MNR) Hydro Network layer that indicates stream flow and order throughout the province of Ontario. In order to identify headwater pour points, all first order stream intersection points (i.e. where one or more first order streams intersect with another stream) were identified using a python script and ArcGIS Pro.</p>" +
                "<p>Headwater/recharge watershed layer</p>" +
                "<p>This layer was produced using the MNR provincial digital elevation model (PDEM) and the previously produced pour point layer. Using the PDEM and ArcGIS Pro a flow direction raster was produced. This layer along with the pour point layer were used as the inputs for the watershed tool available withing ArcGIS Pro. Using python, the watershed tool was applied to each pour point within a 10 kilometer radius from a city/town that had been generated thus producing several thousand watersheds.</p>" +
                "<p>Discharge watersheds Layer/Pour Point Layer</p>" +
                "<p>As the exact definition of a discharge watershed is slightly vague, watershed that connect smaller stream systems to larger ones and pass directly through a town/city were identified and delineated. This was all completed using the Ontario Watershed Information Tool.</p>" +
                "<p>Darcy Flow Layer:</p>" +
                "<p>The Darcy flow layers were created using a variety of layers as indicated above. Using a variety of soil survey data soil types were assigned a hydrological conductivity and porosity coefficient using standard values and values assignment by the ministry of agriculture and Agri foods. After this depth to bedrock was estimated throughout the study areas using a PDEM along with depth to bedrock data available through the Canadian Water Quality Network database. This was completed using data interpolation techniques and was one area that created uncertainty in this project. Finally, after appropriately preparing all these datasets for use, the Darcy flow tool was used in order to estimate ground water subsurface flow rates at saturation throughout all the headwater watersheds that have been delineated. As the output of the Darcy Flow tool is a raster data set where each cell represents the estimates subsurface flow rate in m/s, the average cell value for each watershed was calculated and displayed to give a better visual representation of the flow rate for each watershed.</p>" +
                "<h2>Intro:</h2>" +
                "<p>The working watersheds project is meant to help bridge gaps in watershed knowledge in the context of understanding the risks associated with disturbing or losing the integrity of watersheds throughout Ontario. This project aims to give the public an easy-to-use tool that can tell them where a wetland or water body sits within a watershed and what benefits different wetlands and waterbodies may have based on this. Many of the headwater and discharge watersheds throughout the Land Between bioregion. Headwaters play a major role in ground water recharge to wetlands and pave the way for larger river and lake ecosystems and lower elevations by delivering a consistent source of ground water and surface flow. Wetlands play an important role in water security in the context of head waters as they regulate the water delivery from head waters, protect from flood control and help to maintain water quality. Thatâ€™s why we have identified all the wetlands that intersect with head water watersheds to give the public a better of the wetlands that may be most important for their communities but may be overlooked in provincial or municipal legislation. The same has been done with discharge watersheds to understand what wetlands may be most critical for flood mitigation and water attenuation further along the water cycle.</p>";

            return div;
        }
    </script>
</body>

</html>
