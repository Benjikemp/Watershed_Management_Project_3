<!DOCTYPE html>
<html>

<head>
    <title>The Land Between Recharge Zones</title>
    <style>
        #header {
            background-color: #ffffff;
            /* Background color for the header */
            text-align: center;
            padding: 20px;
            /* Adjust the padding for spacing */
        }

        #logo {
            width: 150px;
            /* Adjust the logo width */
        }

        #title {
            font-size: 24px;
            margin-top: 10px;
            /* Adjust the margin for spacing */
        }

        #map {
            height: 400px;
            margin: 0 auto;
            /* Center the map horizontally */
        }

        body {
            text-align: center;
            /* Center align the title */
        }

        .metadata-section {
            text-align: left;
            padding: 20px;
            display: none;
        }
    </style>
    <link rel="stylesheet" href="leaflet/leaflet.css" />
    <style>
        .legend {
            background-color: white;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            clear: both;
            font-size: 12px;
            line-height: 18px;
            color: #555;
        }

        .legend i {
            width: 18px;
            height: 18px;
            float: left;
            margin-right: 8px;
            opacity: 0.7;
        }
    </style>
</head>

<body>
    <div id="header">
        <img id="logo" src="Logo_TLB_2.png" alt="Working Watershed Project Logo">
        <h1 id="title">Working Watersheds Mapping</h1>
    </div>
    <div id="map"></div>
    <div id="metadataText" class="metadata-section">
        <h2>Layers Produced:</h2>
        <ul>
            <li>Headwater/recharge watersheds layer</li>
            <li>Headwater/recharge watersheds pour point layer</li>
            <li>Discharge watersheds Layer</li>
            <li>Discharge watersheds pour point Layer</li>
            <li>Wetland classification layer</li>
            <li>Darcy flow layer</li>
        </ul>

        <h2>Data sources Used:</h2>
        <ul>
            <li>Headwater/recharge pour point layer
                <ul>
                    <li>MNR Hydro Network</li>
                </ul>
            </li>
            <li>Headwater/recharge watershed layer
                <ul>
                    <li>Headwater/recharge pour point layer.</li>
                    <li>MNR Provincial Digital Elevation Model</li>
                </ul>
            </li>
            <li>Discharge watersheds Layer
                <ul>
                    <li>Ontario Watershed Information Tool (OWIT)</li>
                    <li>MNR Provincial Digital Elevation Model</li>
                </ul>
            </li>
            <li>Wetland Classification Layer
                <ul>
                    <li>FRI wetland layer</li>
                    <li>MNR wetland layers (Classified and unclassified)</li>
                    <li>MNR Ontario Soil Survey</li>
                    <li>Ontario Water Monitoring Network</li>
                </ul>
            </li>
            <li>Darcy Flow Layer
                <ul>
                    <li>Ontario Water Monitoring Network</li>
                    <li>MNR Provincial Digital Elevation Model</li>
                    <li>MNR Ontario Soil Survey</li>
                    <li>Canadian Soil Information Service</li>
                    <li>Agriculture and Agri foods Canada Soils of Canada datasets</li>
                    <li>The Government of Canada’s National Soil Database</li>
                    <li>The Ontario Geological Survey (OGS)</li>
                </ul>
            </li>
        </ul>

        <h2>Methods:</h2>
        <ul>
            <li>Headwater/recharge pour point layer.
                <p>This layer was produced using the Ministry of Natural Resources (MNR) Hydro Network layer that indicates stream flow and order throughout the province of Ontario. In order to identify headwater, pour points, all first-order stream intersection points (i.e., where one or more first-order streams intersect with another stream) were identified using a Python script and ArcGIS Pro.</p>
            </li>
            <li>Headwater/recharge watershed layer
                <p>This layer was produced using the MNR provincial digital elevation model (PDEM) and the previously produced pour point layer. Using the PDEM and ArcGIS Pro a flow direction raster was produced. This layer along with the pour point layer were used as the inputs for the watershed tool available within ArcGIS Pro. Using Python, the watershed tool was applied to each pour point within a 10-kilometer radius from a city/town that had been generated thus producing several thousand watersheds.</p>
            </li>
            <li>Discharge watersheds Layer/Pour Point Layer
                <p>Watersheds that connect smaller stream systems to larger ones and pass directly through a town/city were identified and delineated and termed discharge watersheds. This was all completed using the Ontario Watershed Information Tool.</p>
            </li>
            <li>Darcy Flow Layer:
                <p>The Darcy flow layers were created using a variety of layers as indicated above. Using a variety of soil survey data soil types were assigned a hydrological conductivity and porosity coefficient using standard values and values assignment by the ministry of agriculture and Agri foods. After this depth to bedrock was estimated throughout the study areas using a PDEM along with depth to bedrock data available through the Canadian Water Quality Network database. This was completed using data interpolation techniques and was one area that created uncertainty in this project. Finally, after appropriately preparing all these datasets for use, the Darcy flow tool was used in order to estimate groundwater subsurface flow rates at saturation throughout all the headwater watersheds that have been delineated. As the output of the Darcy Flow tool is a raster dataset where each cell represents the estimates subsurface flow rate in m/s, the average cell value for each watershed was calculated and displayed to give a better visual representation of the flow rate for each watershed.</p>
            </li>
        </ul>

        <h2>Intro:</h2>
        <p>The working watersheds project is meant to help bridge gaps in watershed knowledge in the context of understanding the risks associated with disturbing or losing the integrity of watersheds throughout Ontario. This project aims to give the public an easy-to-use tool that can tell them where a wetland or water body sits within a watershed and what benefits different wetlands and water bodies may have based on this. Many of the headwater and discharge watersheds throughout the Land Between bioregion. Headwaters play a major role in groundwater recharge to wetlands and pave the way for larger river and lake ecosystems and lower elevations by delivering a consistent source of groundwater and surface flow. Wetlands play an important role in water security in the context of headwaters as they regulate the water delivery from headwaters, protect from flood control, and help to maintain water quality. That’s why we have identified all the wetlands that intersect with headwater watersheds to give the public a better understanding of the wetlands that may be most important for their communities but may be overlooked in provincial or municipal legislation. The same has been done with discharge watersheds to understand what wetlands may be most critical for flood mitigation and water attenuation further along the water cycle.</p>
    </div>

    <script src="leaflet/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-ajax@2.1.0/dist/leaflet.ajax.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chroma-js@2.1.0"></script>
    <script>
        var map = L.map('map').setView([0, 0], 10);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

        function getColor(d) {
            return chroma.scale(['lightblue', 'darkblue']).mode('lab')(d);
        }

        function onEachFeature(feature, layer) {
            if (feature.properties) {
                var popupContent = "<h3>Feature Attributes</h3>" +
                    "<strong>Velocity (m/s):</strong> " + feature.properties.MEAN_Darcy_velocity + "<br>";
                layer.bindPopup(popupContent);
            }
        }

        var values = [0, 0.05, 0.1, 0.15, 0.2];

        var legend = L.control({ position: 'bottomright' });

        legend.onAdd = function (map) {
            var div = L.DomUtil.create('div', 'info legend');
            div.innerHTML += '<h4>Flow Velocity (m/s)</h4>';
            for (var i = 0; i < values.length - 1; i++) {
                div.innerHTML +=
                    '<i style="background:' + getColor((values[i] + values[i + 1]) / 2) + '"></i> ' +
                    values[i] + (values[i + 1] ? '&ndash;' + values[i + 1] + '<br>' : '+');
            }
            return div;
        };

        legend.addTo(map);

        var baseMaps = {
            "Map": L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png')
        };

        var darcyFlowLayerOne = L.geoJSON.ajax("AverageSubsurf_FeaturesToJSO1.geojson", {
            style: function (feature) {
                return {
                    fillColor: getColor(feature.properties.MEAN_Darcy_velocity),
                    color: 'black',
                    weight: 1,
                    opacity: 1,
                    fillOpacity: 0.7,
                };
            },
            onEachFeature: onEachFeature,
        });

        var darcyFlowLayerTwo = L.geoJSON.ajax("AverageSubsurf_FeaturesToJSO2.geojson", {
            style: function (feature) {
                return {
                    fillColor: getColor(feature.properties.MEAN_Darcy_velocity),
                    color: 'black',
                    weight: 1,
                    opacity: 1,
                    fillOpacity: 0.7,
                };
	},
            onEachFeature: onEachFeature,
        });

        // Combine Darcy Flow layers into a single layer group
        var darcyFlowLayersGroup = L.layerGroup([darcyFlowLayerOne, darcyFlowLayerTwo]);

        var headWaterPourPoints = L.geoJSON.ajax("ToJSO.geojson", {
            pointToLayer: function (feature, latlng) {
                return L.circleMarker(latlng, {
                    radius: 5,
                    fillColor: 'black',
                    color: 'black',
                    weight: 1,
                    opacity: 1,
                    fillOpacity: 0.7,
                });
            },
            onEachFeature: onEachFeature,
        });

        var dischargeWatersheds = L.geoJSON.ajax("Discharge_Zone_FeaturesToJSO.geojson", {
            style: {
                fillColor: 'yellow',
                color: 'yellow',
                weight: 1,
                opacity: 1,
                fillOpacity: 0.7,
            },
            onEachFeature: onEachFeature,
        });

        var dischargePourPoints = L.geoJSON.ajax("Watershed4Pour_FeaturesToJSO.geojson", {
            pointToLayer: function (feature, latlng) {
                return L.circleMarker(latlng, {
                    radius: 5,
                    fillColor: 'red',
                    color: 'red',
                    weight: 1,
                    opacity: 1,
                    fillOpacity: 0.7,
                });
            },
            onEachFeature: onEachFeature,
        });

        L.control.layers(baseMaps, {
            "Head-Water Watersheds": L.geoJSON.ajax("Recharge_Zones_ToJSO.geojson", {
                style: {
                    color: 'red',
                    weight: 2,
                },
                onEachFeature: onEachFeature,
            }),
            "Average Subsurface Flow (m/s)": darcyFlowLayersGroup,
            "Head-Water Pour Points": headWaterPourPoints,
            "Discharge Watersheds": dischargeWatersheds,
            "Discharge Pour Points": dischargePourPoints,
        }, {
            collapsed: false,
            groupName: "Layers",
            metadataText: document.getElementById('metadataText'),
        }).addTo(map);

        // Show metadata text when "Metadata" is selected
        map.on('overlayadd', function (eventLayer) {
            if (eventLayer.name === 'Average Subsurface Flow (m/s)') {
                document.getElementById('metadataText').style.display = 'block';
            }
        });

        // Hide metadata text when other layers are selected
        map.on('overlayremove', function (eventLayer) {
            if (eventLayer.name === 'Average Subsurface Flow (m/s)') {
                document.getElementById('metadataText').style.display = 'none';
            }
        });

        // Function to toggle visibility of a metadata section
        function toggleMetadataSection(sectionId) {
            var section = document.getElementById(sectionId);
            if (section.style.display === 'none') {
                section.style.display = 'block';
            } else {
                section.style.display = 'none';
            }
        }
    </script>
</body>

</html>









